<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-CA" }}">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>{{ page.title }} - {{ site.title }}</title>
    <link rel="stylesheet" href="{{ "assets/css/alt.css" | relative_url }}">
    <script type="text/javascript" src="/assets/js/randoText404.js"></script>
    <script type="text/javascript" src="/assets/js/BGM.js"></script>
    <script>
    function loadJSON(src) {
      return fetch(src).then(res => {
        if (!res.ok) throw new Error(`Failed to load ${src}`);
        return res.json();
      });
    }

    Promise.all([
      loadJSON('/assets/js/json/error.json')
    ]).then(([updates, lines]) => {
      window.updatesData = updates;
      window.linesData = lines;
      // Now load the rest of the scripts
      var scripts = [
        '/assets/js/randoText404.js',
      ];
      scripts.forEach(function(src) {
        var s = document.createElement('script');
        s.src = src;
        document.head.appendChild(s);
      });
    }).catch(err => {
      console.error('Error loading JSON:', err);
    });
  </script>
  {% if page.type == 'flash' %}
    <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  {% endif %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="alternate" type="application/rss+xml" title="{{ site.title }}"
        href="{{ "/feed.xml" | relative_url }}" />
  {% include meta.html %}
</head>
{% assign game_type = page.type | default: 'html' %}

<body data-type="{{ game_type }}">
    {% include gtag.html %}
    {% if page.title == "404" %}
    <audio id="BGM" loop>
        Your browser does not support the audio element.
    </audio>
    {% endif %}
    <div class="container">
        <div class="box">
            {% if page.title == "404" or page.index == true %}
            {{ content }}
            {% else %}
            <div class="page-header">
            <h1 class="page-title">{{ page.title }}</h1>
            </div>
            <br>
            {% include breadcrumbs.html %}
            <br>
            <script type="text/javascript" src="/assets/js/aspectRatio.js"></script>
            <script>
                let aspectRatioInfo = getAspectRatioInfo('{{ page.aspectRatio }}')
            </script>
    {% if game_type == 'flash' %}
            <div class="fullscreen-center-wrapper" id="fullscreen-wrapper">
             <iframe id="game-iframe" srcdoc='
                <object width="100" height="100">
                <embed
                id="game-embed"
                src="src/game.swf"
                flashvars=""
                base="" 
                quality="high"
                allowscriptaccess="always"
                allowfullscreen="true"
                wmode="window"
                type="application/x-shockwave-flash" 
                pluginspage="http://www.macromedia.com/go/getflashplayer">
                </object>
            ' allowfullscreen ></iframe>
            </div>
            <button id="fullscreen-btn" style="margin-top:10px;">Fullscreen</button>
            <a href="src/game.swf" download class="btn btn-secondary">Download</a>
      {% elsif game_type == 'html' %}
             <div class="fullscreen-center-wrapper" id="fullscreen-wrapper">
             <iframe id="game-iframe" srcdoc='
                <object width="100" height="100">
                <embed
                id="game-embed"
                src="src/index.html"
                flashvars=""
                base="" 
                quality="high"
                allowscriptaccess="always"
                allowfullscreen="true"
                wmode="window"
                </object>
            ' allowfullscreen></iframe>
            </div>
            <button id="fullscreen-btn" style="margin-top:10px;">Fullscreen</button>
    {% elsif game_type == 'dos' %}
            <div class="fullscreen-center-wrapper" id="fullscreen-wrapper">
             <iframe id="game-iframe" srcdoc='
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="https://v8.js-dos.com/latest/js-dos.css">
<style>
  html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; }
  #dos-canvas { width: 100%; height: 100%; }
</style>
<script src="https://v8.js-dos.com/latest/js-dos.js"></script>
</head>
<body>
<div id="dos-canvas"></div>
<script>
  (function () {
    var dosInstance = null;

    function initDos() {
      var canvas = document.getElementById("dos-canvas");
      if (!canvas || typeof Dos !== "function") {
        console.error("js-dos canvas or library unavailable");
        return;
      }

      var options = {
        renderAspect: "Fit",
        autoStart: true,
        kiosk: true,
        autoSave: true,
        url: "src/game.jsdos",
      };

      Dos(canvas, options)
        .then(function (instance) {
          dosInstance = instance;
          window.dosInstance = instance;
          window.__dosInstance = instance;
        })
        .catch(function (error) {
          console.error("Failed to initialise js-dos", error);
        });
    }

    window.requestDosFullscreen = function () {
      if (dosInstance && typeof dosInstance.setFullScreen === "function") {
        try {
          dosInstance.setFullScreen(true);
          return true;
        } catch (error) {
          console.error("js-dos fullscreen request failed", error);
        }
      }
      return false;
    };

    if (document.readyState === "complete" || document.readyState === "interactive") {
      setTimeout(initDos, 0);
    } else {
      window.addEventListener("DOMContentLoaded", initDos);
    }
  })();
</script>
</body>
</html>
' allow="fullscreen" allowfullscreen></iframe>
            </div>
      <button id="fullscreen-btn" style="margin-top:10px;">Fullscreen</button>
            {% else %}
            <div class="fullscreen-center-wrapper" id="fullscreen-wrapper">
             <iframe id="game-iframe" src="src/index.html" allowfullscreen></iframe>
            </div>
            <button id="fullscreen-btn" style="margin-top:10px;">Fullscreen</button>
            {% endif %}
            {% endif %}
            <link rel="stylesheet" href="{{ "assets/css/gameWrapper.css" | relative_url }}">
            <script type="text/javascript" src="/assets/js/gameWrapper.js"></script>
        </div>
    </div>
      <div class="footer" role="contentinfo">
      <div class="inner" style="text-align:center; padding:0.5em 1em;">
  <p>&copy; {% assign thisyear = site.time | date: "%Y" %}{% if thisyear == "2025" %}2025{% else %}2025 - {{ thisyear }}{% endif %} Bored Entertainment. All rights reserved.</p>
      </div>
    </div>
    {% if page.title == "404" %}
    <div id="background" class="background"></div>
    <div id="background2" class="background"></div>
    {% endif %}

</body>
</html>